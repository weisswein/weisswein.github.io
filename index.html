<!-- <!DOCTYPE html>
<html>
<head>
  <title>Realtime communication with WebRTC</title>
  <script src="https://js.kintone.com/v1/sdk.js"></script>
  <link rel="stylesheet" href="css/main.css" />
</head>
<body>
  <!-- <h1>Realtime communication with WebRTC</h1> -->

<!--   <video autoplay playsinline></video>
  <script src="js/main.js"></script>
</body>
</html> -->

<html>
<head><title>Webカメラの映像をvideoとcanvasに表示</title></head>

<body>
<h1>Webカメラの映像をvideoとcanvasに表示</h1>
<div id="contents"></div>
<div><a id="download" href="#" download="canvas.png" onClick="downloadImage()">画像ダウンロード</a></div>
</body>

<script type="text/javascript">

    const cameraSize = { w: 640,  h: 400 };
    const canvasSize = { w: 640,  h: 400 };
    const resolution = { w: 1280, h: 720 };

    // video にWebカメラの映像を表示
    let videoPreview    = document.createElement('div');
    let videoText       = document.createElement('p');
    videoText.innerHTML = 'videoにWebカメラ表示';
    videoPreview.appendChild(videoText);

    let video      = document.createElement('video');
    video.id       = 'video';
    video.width    = cameraSize.w;
    video.height   = cameraSize.h;
    video.autoplay = true;
    videoPreview.appendChild(video);

    document.getElementById('contents').appendChild(videoPreview);

    // Webカメラの映像を video にセット
    let media = navigator.mediaDevices.getUserMedia({
        audio: false,
        video: {
            width:  { ideal: resolution.w },
            height: { ideal: resolution.h }
        }
    }).then(function(stream) {
        video.srcObject = stream;
    });

    // canvas にvideoの映像を表示
    let canvasPreview    = document.createElement('div');
    let canvasText       = document.createElement('p');
    canvasText.innerHTML = 'canvasにvideoのWebカメラ画像を表示';
    canvasPreview.appendChild(canvasText);

    let canvas    = document.createElement('canvas');
    canvas.id     = 'canvas';
    canvas.width  = canvasSize.w;
    canvas.height = canvasSize.h;
    canvasPreview.appendChild(canvas);

    document.getElementById('contents').appendChild(canvasPreview);

    // video の映像を canvas にセット
    let canvasCtx = canvas.getContext('2d');
    canvasUpdate();

    function canvasUpdate() {
      canvasCtx.drawImage(video, 0, 0, canvas.width, canvas.height);
      requestAnimationFrame(canvasUpdate);
    };

    // canvasの画像をダウンロード
    function downloadImage() {
      var base64 = canvas.toDataURL();
      document.getElementById("download").href = base64;
    }
</script>
</html>
